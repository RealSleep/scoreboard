<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scoreboard</title>
    <style type="text/css">
      .container {
        display: flex;
        justify-content: space-around;
        text-align: center;
      }

      .score_container {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="team_0">
        <div class="name_container">
          <h1 class="name"></h1>  
        </div>
        <div class="name_input_container">
          <label for="name_input">Team name:</label>
          <input type="text" name="name_input" maxlength="10" value="" class="name_input">
        </div>
        <div class="score_container">
          <button class="add_btn">+</button>
          <p class="score"></p>
         <button class="subtract_btn">-</button>
        </div>  
      </div>
      <div class="team_1">
        <div class="name_container">
          <h1 class="name"></h1>  
        </div>
        <div class="name_input_container">
          <label for="name_input">Team name:</label>
          <input type="text" name="name_input" maxlength="10" value="" class="name_input">
        </div>
        <div class="score_container">
          <button class="add_btn">+</button>
          <p class="score"></p>
         <button class="subtract_btn">-</button>
        </div>  
      </div>
    </div>
    <script>

      const team_score = document.getElementsByClassName("score");    
      const team_name = document.getElementsByClassName("name");    

      const team_name_input = document.getElementsByClassName("name_input");
      const team_add_btn = document.getElementsByClassName("add_btn");
      const team_subtract_btn = document.getElementsByClassName("subtract_btn");

      for (var i = 0; i < team_name_input.length; i++) {
          team_name_input[i].addEventListener("input", nameEventHandler);
        }

      for (var i = 0; i < team_add_btn.length; i++) {
        team_add_btn[i].addEventListener("click", scoreEventHandler);
      }

      for (var i = 0; i < team_subtract_btn.length; i++) {
        team_subtract_btn[i].addEventListener("click", scoreEventHandler);
      }

      for (var i = 0; i < 2; i++) {
        updateScore("/score", i);
      }
      for (var i = 0; i < 2; i++) {
        updateName("/name", i, "");
      }

      async function nameEventHandler(event) {
        var indexOfTeam = event.path[2].className.at(5);
        var input_from_user = event.target.value; 
        var path = event.srcElement.className;
        updateName(path, indexOfTeam, input_from_user);
      }

      async function updateName(path, indexOfTeam, input_from_user) {
        const newName = await requestNewName(path, indexOfTeam, input_from_user);
        team_name[indexOfTeam].textContent = newName;
      }

      async function requestNewName(path, indexOfTeam, input_from_user) {
        const response = await fetch(path + "?team_number="+ indexOfTeam + "&name=" + input_from_user);
        const newName = await response.text();
        return newName;
      }
      
      async function scoreEventHandler(event) {
        var indexOfTeam = event.path[2].className.at(5);
        var path = event.srcElement.className;
        updateScore(path, indexOfTeam);
      }

      async function updateScore(path, indexOfTeam) {
        var score = team_score[indexOfTeam];
        var newScore = await requestNewScore(path, indexOfTeam);
        score.textContent = newScore;
      }

      async function requestNewScore(path, indexOfTeam) {
        const response = await fetch(path + "?team_number="+ indexOfTeam);
        const newScore = await response.text();
        return newScore;
      }

    </script>
  </body>
</html>